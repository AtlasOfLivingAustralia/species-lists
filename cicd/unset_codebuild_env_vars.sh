#!/bin/bash

###
# This script unsets all CodeBuild environment variables that we dont want to be
# passed to the application configuration.

codebuild_env_vars=(
  "ARTIFACTS_BUCKET"
  "AWS_CONTAINER_CREDENTIALS_RELATIVE_URI"
  "AWS_EXECUTION_ENV"
  "CODEBUILD_ACTION_RUNNER_URL"
  "CODEBUILD_AGENT_ENDPOINT"
  "CODEBUILD_AUTH_TOKEN"
  "CODEBUILD_BMR_URL"
  "CODEBUILD_BUILD_ARN"
  "CODEBUILD_BUILD_ID"
  "CODEBUILD_BUILD_IMAGE"
  "CODEBUILD_BUILD_NUMBER"
  "CODEBUILD_BUILD_SUCCEEDING"
  "CODEBUILD_BUILD_URL"
  "CODEBUILD_CI"
  "CODEBUILD_CONTAINER_NAME"
  "CODEBUILD_EXECUTION_ROLE_BUILD"
  "CODEBUILD_FE_REPORT_ENDPOINT"
  "CODEBUILD_GOPATH"
  "CODEBUILD_INITIATOR"
  "CODEBUILD_KMS_KEY_ID"
  "CODEBUILD_LAST_EXIT"
  "CODEBUILD_LOG_PATH"
  "CODEBUILD_PROJECT_UUID"
  "CODEBUILD_RESOLVED_SOURCE_VERSION"
  "CODEBUILD_SOURCE_VERSION"
  "CODEBUILD_SRC_DIR"
  "CODEBUILD_START_TIME"
  "CUR_PIPELINE_FINGERPRINT"
  "DEBIAN_FRONTEND"
  "DOTNET_6_GLOBAL_JSON_SDK_VERSION"
  "DOTNET_6_SDK_VERSION"
  "DOTNET_8_GLOBAL_JSON_SDK_VERSION"
  "DOTNET_8_SDK_VERSION"
  "DOTNET_ROOT"
  "ECS_AGENT_URI"
  "ECS_CONTAINER_METADATA_URI"
  "ECS_CONTAINER_METADATA_URI_V4"
  "GOENV_DISABLE_GOPATH"
  "GOLANG_20_VERSION"
  "GOLANG_21_VERSION"
  "GOLANG_22_VERSION"
  "GOPATH"
  "HOSTNAME"
  "JAVA_11_HOME"
  "JAVA_17_HOME"
  "JAVA_21_HOME"
  "JAVA_8_HOME"
  "JAVA_HOME"
  "JDK_11_HOME"
  "JDK_17_HOME"
  "JDK_21_HOME"
  "JDK_8_HOME"
  "JDK_HOME"
  "JRE_11_HOME"
  "JRE_17_HOME"
  "JRE_21_HOME"
  "JRE_8_HOME"
  "JRE_HOME"
  "LC_CTYPE"
  "MAVEN_OPTS"
  "NODE_18_VERSION"
  "NODE_20_VERSION"
  "NODE_22_VERSION"
  "NUGET_XMLDOC_MODE"
  "OLDPWD"
  "PHP_82_VERSION"
  "PHP_83_VERSION"
  "PHP_BUILD_CONFIGURE_OPTS"
  "PHP_BUILD_EXTRA_MAKE_ARGUMENTS"
  "PIPELINE_FINGERPRINT"
  "PWD"
  "PYTHON_310_VERSION"
  "PYTHON_311_VERSION"
  "PYTHON_312_VERSION"
  "PYTHON_39_VERSION"
  "PYTHON_CONFIGURE_OPTS"
  "PYTHON_PIP_VERSION"
  "PYYAML_VERSION"
  "RBENV_SRC_DIR"
  "RUBY_31_VERSION"
  "RUBY_32_VERSION"
  "RUBY_33_VERSION"
  "RUBY_BUILD_SRC_DIR"
  "SHLVL"
  "_"
)

# Loop through each environment variable and unset it
for var in "${codebuild_env_vars[@]}"; do
  unset "$var"
  echo "Unset variable: $var"
done